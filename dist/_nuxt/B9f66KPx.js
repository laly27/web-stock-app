import{j,k as O,n as y,s as V,m as D,c as r,a as t,v as F,F as f,r as v,l as h,x as w,y as k,t as n,o as i,b as I,w as T,d as A,e as $}from"./DiblFvHu.js";const z={class:"space-y-6 mt-12"},B={class:"flex justify-between items-center"},L={class:"card"},M={class:"overflow-x-auto"},R={class:"min-w-full divide-y divide-gray-200"},U={class:"bg-white divide-y divide-gray-200"},E={class:"px-6 py-4 whitespace-nowrap font-medium text-gray-900"},H={class:"px-6 py-4 whitespace-nowrap text-gray-900"},P={class:"px-6 py-4 whitespace-nowrap text-gray-600"},X={class:"px-6 py-4 whitespace-nowrap font-semibold text-green-600"},G={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},J={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},K={class:"bg-white rounded-lg p-6 w-full max-w-4xl m-4 max-h-[90vh] overflow-y-auto"},Q={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},W={class:"space-y-3 max-h-96 overflow-y-auto"},Y={class:"flex-1"},Z={class:"font-medium text-gray-900"},tt={class:"text-sm text-gray-600"},et={class:"text-xs text-gray-500"},st={class:"flex items-center space-x-2"},ot=["onUpdate:modelValue","max"],at=["onClick","disabled"],nt={class:"mb-4"},rt={class:"bg-gray-50 rounded-lg p-4 space-y-3"},it={key:0,class:"text-center text-gray-500 py-4"},lt={key:1},dt={class:"flex-1"},ct={class:"font-medium text-sm"},ut={class:"text-xs text-gray-600"},mt={class:"text-right"},xt={class:"font-medium"},pt=["onClick"],yt={class:"border-t border-gray-200 pt-3 mt-3"},ft={class:"flex justify-between items-center"},vt={class:"font-bold text-lg text-green-600"},gt={class:"flex justify-end space-x-3 mt-6"},_t=["disabled"],wt={__name:"commandes",setup(bt){const g=j(),_=O(),m=y(!1),u=y(""),l=V({}),a=y([]),b=D(()=>a.value.reduce((o,e)=>o+e.subtotal,0)),c=o=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF"}).format(o),C=o=>new Date(o).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),N=o=>{const e=parseInt(l[o.id])||0;if(e>0&&e<=o.quantity){const d=a.value.findIndex(s=>s.product.id===o.id);d!==-1?(a.value[d].quantity+=e,a.value[d].subtotal=a.value[d].quantity*o.price):a.value.push({product:o,quantity:e,subtotal:e*o.price}),l[o.id]=0}},q=o=>{a.value=a.value.filter(e=>e.product.id!==o)},S=()=>{if(a.value.length===0)return;for(const e of a.value)if(!g.decrementStock(e.product.id,e.quantity)){alert(`Stock insuffisant pour ${e.product.name}`);return}const o={items:a.value.map(e=>({productId:e.product.id,productName:e.product.name,quantity:e.quantity,price:e.product.price,subtotal:e.subtotal})),total:b.value,customerName:u.value||"Client"};_.createOrder(o),x(),alert("Commande crÃ©Ã©e avec succÃ¨s!")},x=()=>{m.value=!1,u.value="",a.value=[],Object.keys(l).forEach(o=>l[o]=0)};return(o,e)=>{const d=$;return i(),r("div",z,[t("div",B,[e[2]||(e[2]=t("div",null,[t("h2",{class:"text-3xl font-bold text-gray-900 mb-2"},"Commandes"),t("p",{class:"text-gray-600"},"CrÃ©ez et gÃ©rez les commandes")],-1)),t("button",{onClick:e[0]||(e[0]=s=>m.value=!0),class:"btn-primary"}," âž• Nouvelle commande ")]),t("div",L,[e[5]||(e[5]=t("div",{class:"p-6 border-b border-gray-200"},[t("h3",{class:"text-lg font-semibold text-gray-900"},"Historique des commandes")],-1)),t("div",M,[t("table",R,[e[4]||(e[4]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," NÂ° Commande "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Client "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Total "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),t("tbody",U,[(i(!0),r(f,null,v(h(_).orders.slice().reverse(),s=>(i(),r("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",E," #"+n(s.id.slice(-6)),1),t("td",H,n(s.customerName),1),t("td",P,n(C(s.createdAt)),1),t("td",X,n(c(s.total)),1),t("td",G,[I(d,{to:`/factures?order=${s.id}`,class:"text-blue-600 hover:text-blue-900"},{default:T(()=>e[3]||(e[3]=[A(" ðŸ“„ Voir facture ")])),_:2,__:[3]},1032,["to"])])]))),128))])])])]),m.value?(i(),r("div",J,[t("div",K,[t("div",{class:"flex justify-between items-center mb-6"},[e[6]||(e[6]=t("h3",{class:"text-lg font-semibold"},"Nouvelle commande",-1)),t("button",{onClick:x,class:"text-gray-500 hover:text-gray-700"}," âœ• ")]),t("div",Q,[t("div",null,[e[7]||(e[7]=t("h4",{class:"font-medium text-gray-900 mb-4"},"SÃ©lectionner les produits",-1)),t("div",W,[(i(!0),r(f,null,v(h(g).products.filter(s=>s.quantity>0),s=>(i(),r("div",{key:s.id,class:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50"},[t("div",Y,[t("p",Z,n(s.name),1),t("p",tt,n(s.category)+" - "+n(c(s.price)),1),t("p",et,"Stock: "+n(s.quantity),1)]),t("div",st,[w(t("input",{"onUpdate:modelValue":p=>l[s.id]=p,type:"number",min:"0",max:s.quantity,class:"w-16 px-2 py-1 border border-gray-300 rounded text-center",placeholder:"0"},null,8,ot),[[k,l[s.id]]]),t("button",{onClick:p=>N(s),class:"btn-primary text-sm px-3 py-1",disabled:!l[s.id]||l[s.id]<=0}," Ajouter ",8,at)])]))),128))])]),t("div",null,[t("div",nt,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nom du client",-1)),w(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>u.value=s),type:"text",class:"input-field",placeholder:"Nom du client"},null,512),[[k,u.value]])]),e[10]||(e[10]=t("h4",{class:"font-medium text-gray-900 mb-4"},"RÃ©capitulatif de la commande",-1)),t("div",rt,[a.value.length===0?(i(),r("div",it," Aucun produit sÃ©lectionnÃ© ")):(i(),r("div",lt,[(i(!0),r(f,null,v(a.value,s=>(i(),r("div",{key:s.product.id,class:"flex items-center justify-between"},[t("div",dt,[t("p",ct,n(s.product.name),1),t("p",ut,n(s.quantity)+" Ã— "+n(c(s.product.price)),1)]),t("div",mt,[t("p",xt,n(c(s.subtotal)),1),t("button",{onClick:p=>q(s.product.id),class:"text-red-600 hover:text-red-800 text-xs"}," Supprimer ",8,pt)])]))),128)),t("div",yt,[t("div",ft,[e[9]||(e[9]=t("span",{class:"font-semibold"},"Total:",-1)),t("span",vt,n(c(b.value)),1)])])]))]),t("div",gt,[t("button",{onClick:x,class:"btn-secondary"}," Annuler "),t("button",{onClick:S,class:"btn-success",disabled:a.value.length===0}," Confirmer la commande ",8,_t)])])])])])):F("",!0)])}}};export{wt as default};
